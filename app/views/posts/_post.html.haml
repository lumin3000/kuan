%div[post]{:class => type}
  .content_head
    %span.writer_name<
      %a{href: blog_path(post.author.primary_blog)}
        = post.author.name + '：'
    - if current_user and post.editable_by? current_user
      %a.remove{ :href => post_path(post), :title => '删除',
        :data => { :doconfirm => "确定删除该条帖子吗?", :widget => "rest", :callback => "del", :md => "delete", :parent => "tar_post" }}<
        删除
      = link_to "编辑", edit_post_path(post), :class => 'edit', :title => '编辑'
    %a.open{ :href => posts_blog_path(post), :target => "_blank",
      title: '展开' }
    = link_to "转贴", renew_post_path(post), :class => 'repost', :title => '转贴'
    - favor_href, favor_data = favor_toggle_post_path(post), { :widget => "rest", :callback => "toggle", :md => "put" }
    - faved = current_user && post.favored_by?(current_user)
    - if faved
      - favor_data["class"] = "fave"
      - favor_data["title"] = "喜欢"
      %a{ :href => favor_href, :title => '不喜欢', :class => 'faved', :data => favor_data }<
        不喜欢
    - else
      - favor_data["class"] = "faved"
      - favor_data["title"] = "不喜欢"
      %a{ :href => favor_href, :title => '喜欢', :class => 'fave', :data => favor_data}<
        喜欢
  .content_body
    = render partial: sub_template, object: post
  .content_footer
    - unless post.tags.blank?
      .tags<
        标签：
        - post.tags.each do |tag|
          %a{ :href => tagged_path(tag) }<
            = "#{tag.to(12)}"
            = ", " unless tag == post.tags.last
    .left<
      - unless post.parent.nil?
        %span.repost_info
          转自页面
          %a{ :href => blog_path(post.parent.blog) }
            = post.parent.blog.title
      %span.update_time= post.created_at
    .right.post_stat
      %a.reply{ :href => post_comments_path(post), :title => "评论", :data => { :tgt => "comments" } }<
        = post.comments.count == 0 ? " " : post.comments.count
      - if post.repost_count && post.repost_count > 0
        %a.repost_count{href: posts_blog_path(post)}
          .repost_icon
          .num
            = post.repost_count
      - if post.favor_count && post.favor_count > 0
        %a.favor_count{href: posts_blog_path(post)}
          .favor_icon{class: faved ? 'faved' : 'fave'}
          .num
            = post.favor_count
