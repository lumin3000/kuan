- content_for :head do
  = stylesheet_link_tag 'post_display', 'dashboard'

- flash.each do |k, v|
  .flash
    %div{:class => "#{k}"}= v

.header
  %a.logo{href: "/home"}
  .dash_navigator
    %a{href: "/wall"}墙
    &nbsp;|&nbsp;
    %a{href: "/news"}随便看看
    &nbsp;|&nbsp;
    %a{href: edit_user_path(current_user)}设置
    &nbsp;| 邀请好友加入&nbsp;
    - invite_url = "#{fucking_root}signup/#{current_user.inv_code}"
    %input.invite{readonly: true, value: invite_url, onclick: "this.select();"}><
    &nbsp;|&nbsp;
    %a.logout{ :href => signout_path, :data => { :confirm => "确定登出?" } }><
.dashboard
  .menu
    .dash_operation
      - highlight_following = (@at_dashboard ? 'highlight_following' : '')
      .my_follow{data: {widget: 'fixHover'}, class: highlight_following}
        %a{href: "/home"}
          %span.menu_arrow &nbsp;
          %span.icon_follow &nbsp;
          %span.text_follow
            关注了
            = @user.subs.count
            个页面
        %a.real_fucking_following{href: "/followings"}
          %span.icon_config &nbsp;
      %hr
      .my_reply
        %a{ :href => "/buzz" }
          %span.icon_reply<
            &nbsp;
          %span.text_reply<
            - if current_user.comments_notices.unreads.count > 0
              %span.new
                = "(#{current_user.comments_notices.unreads.count}新)"
            回复
      %hr
      .my_message
        %a{ :href => "/messages" }
          %span.icon_message<
            &nbsp;
          %span.text_message<
            - if current_user.messages.unreads.count > 0
              %span.new
                = "(#{current_user.messages.unreads.count}新)"
            消息
      %hr
      .my_collect
        %a{ :href => "/posts/favors" }
          %span.icon_collect<
            &nbsp;
          %span.text_collect<
            喜欢
      %hr
    .my_pages.shrinked{data: {widget: "shrinked", trigger: ".selector"}}
      %a.selector{href: "/home/#{@blog.uri}"}
        = @blog.title
      - @other_blogs = @blogs.reject {|b| b == @blog}
      .selector_open
        .selector_open_head.selector
          = @blog.title
        .selector_open_menu
          - @other_blogs.each do |b|
            %div
              %a.other_blog{href: "/home/#{b.uri}"}<
                = b.title
        .selector_open_footer
          %a{href: "/blogs/new"} +新建页面
    .page_operation
      %div
        %span.icon_posts &nbsp;
        %span
          %a{href: "/home/#{@blog.uri}"}
            ! #{@blog.total_post_num}篇文章
      %div
        %span.icon_followed &nbsp;
        %span
          %a{href: followers_blog_path(@blog)}
            ! #{@blog.followers_count}人关注
      - if !@blog.primary && @blog.edited?(current_user)
        %div
          %span.icon_members &nbsp;
          %span
            %a{href: editors_blog_path(@blog)}
              ! 成员管理
      - if @blog.customed? current_user
        %div
          %span.icon_config &nbsp;
          %span
            %a{href: edit_blog_path(@blog)} 自定义
      -#
        %div
          %span.icon_remove &nbsp;
          %span
            %a{href: "#"} 删除
      %div
        %span.icon_view &nbsp;
        %span
          %a{href: blog_path(@blog)} 查看
  .main{ :data => { :widget => "sugar" } }
    .head
      .head_avatar<
        %a{href: blog_path(@user.primary_blog)}<
          =image_tag @user.primary_blog.icon.url_for(:medium)
      .post_area
        .left
        - trailing_post_url = "/to/#{@blog.uri}"
        %a.text{href: "/posts/new/text#{trailing_post_url}"}
        %a.picture{href: "/posts/new/pics#{trailing_post_url}"}
        %a.link{href: "/posts/new/link#{trailing_post_url}"}
        %a.video{href: "/posts/new/video#{trailing_post_url}"}
        .right
    .timeline
      = render :partial => "posts/post_full", :collection => @posts, :as => :post
    = pagination(@posts)
= render :partial => 'shared/footer'
